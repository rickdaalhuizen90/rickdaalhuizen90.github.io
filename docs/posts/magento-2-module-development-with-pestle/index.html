<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Magento 2 Module Development with Pestle - Rick Daalhuizen</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://rickdaalhuizen.comfavicon.png><link rel=stylesheet href=/css/style.min.4b2bfb3701049fe0da3e8d6b9d15186ba1dc7e294f0be3e2bca21bb8a330f5dd.css><meta name=description content="Use code generation with Pestle to automate your workflow in Magento 2."><meta property="og:title" content="Magento 2 Module Development with Pestle"><meta property="og:type" content="website"><meta property="og:url" content="https://rickdaalhuizen.com/posts/magento-2-module-development-with-pestle/"><meta property="og:description" content="Use code generation with Pestle to automate your workflow in Magento 2."><meta name=twitter:card content="summary"><meta name=twitter:site content="@zerostaticio"><meta name=twitter:creator content="@zerostaticio"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel=stylesheet></head><body class="page page-default-single"><div id=wrapper class=wrapper><div class=header><a class=header-logo href=https://rickdaalhuizen.com>Rick Daalhuizen</a><div class=menu-main><ul><li class=menu-item-about><a href=/pages/about/>About</a></li><li class=menu-item-posts><a href=/posts/>Posts</a></li></ul></div></div><div class=intro><h1>Magento 2 Module Development with Pestle<span class=dot>.</span></h1></div><div class=content><p>Magento 2 has a wide range of tools that help you with developing modules. One of the well-known CLI tools in Magento is <a href=https://github.com/netz98/n98-magerun2>Magerun</a>. This is an extension of Magento&rsquo;s own CLI tool that already comes out of the box when you install Magento 2. One of my favorite tools that I use a lot is <a href=https://github.com/astorm/pestle>Pestle by Alan Storm</a>.</p><p>Since much of our code we write mainly consists of template (reusable) code, Pestle helps to generate a lot of this code. Ultimately, this saves a lot of time when it comes to developing Magento 2 modules.</p><h2 id=what-is-pestle>What is Pestle</h2><p>You can think of Pestle as a PHP framework that helps you build and organize CLI programs in Magento 2. For example, you can extend existing functions such as the &ldquo;generate&rdquo; function with your own template.
Who is familiar with Python, Pestle is similar to how Python imports modules.
It is also a collection of CLI programs with a focus on Magento 2 code generation.</p><h2 id=install-pestle>Install Pestle</h2><p>Pestle comes in the form of a .phar file (PHP Archive file) and is easy to download as follows. Phar files are self-contained cross-platform, so it works on MacOS, Windows and Linux.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>#with curl:</span>
curl -LO http://pestle.pulsestorm.net/pestle.phar
<span class=c1>#with wget:</span>
wget http://pestle.pulsestorm.net/pestle.phar
</code></pre></div><p>Or you can download one of the other releases on their Github page.
Run the following &ldquo;php pestle.phar version&rdquo; to see which version is installed.</p><h2 id=what-are-we-going-to-build>What are we going to build?</h2><p>We are going to build a simple module with a front-end page that we can navigate to. After installing pestle, run &ldquo;php pestle.phar&rdquo; to see a list of options.</p><p>We are particularly interested in the Magento 2 Generate options. To see only the &ldquo;generate&rdquo; options run:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar <span class=p>|</span> grep generate --color<span class=o>=</span>never
</code></pre></div><h2 id=register-a-module>Register a module</h2><p>We start by registering a module. Now there are 2 options, the &ldquo;full-module&rdquo; and the &ldquo;module&rdquo; option.</p><p>The full module works slightly different from the module option. Instead of directly creating PHP and XML module files, this option generates a Unix shell script that executes other pestle commands to generate the module.</p><p>For now we stick to the &ldquo;module&rdquo; option. run:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar magento2:generate:module
</code></pre></div><p>Pestle will now come up with a few questions.</p><ul><li>What the vendor namespace should be</li><li>What the name of the module should be.</li><li>Which version. See as follows:</li></ul><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>www-data@example-php-fpm:04:51 PM:/var/www/html$ php pestle.phar magento2:generate:module
Vendor Namespace? <span class=o>(</span>Pulsestorm<span class=o>)]</span> Rick
Module Name? <span class=o>(</span>Testbed<span class=o>)]</span> Helloworld
Version? <span class=o>(</span>0.0.1<span class=o>)]</span> 
Creating <span class=o>[</span>/var/www/html/app/code/Rick/Helloworld/etc<span class=o>]</span> 
Created: /var/www/html/app/code/Rick/Helloworld/etc/module.xml
Created: /var/www/html/app/code/Rick/Helloworld/registration.php
</code></pre></div><p>After this is done you will see that under app/code/Rick a module HelloWorld has now been created. Run &ldquo;bin/magento s:up&rdquo; to register it.</p><figure><img src=pestle-folder-structure.png alt="Pestle folder structure"></figure><h2 id=create-a-front-end-route>Create a front-end route</h2><p>Now that we have created and installed a module, we can create a route.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar magento2:generate:route
</code></pre></div><p>Then you fill in the questions just as you did with generate: module.</p><ul><li>Choose in which module you want to create the route, in our case that is Rick_Helloworld</li><li>Choose whether it is a front-end or admin route, the default is front-end so just press enter.</li><li>The front-name and route id: rick_helloworld</li><li>Use default (Index) as &ldquo;Controller name&rdquo;</li><li>Use default (Index) as &ldquo;Action name&rdquo;</li></ul><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>www-data@example-php-fpm:04:51 PM:/var/www/html$ php pestle.phar magento2:generate:route 
Which Module? <span class=o>(</span>Pulsestorm_HelloWorld<span class=o>)]</span> Rick_Helloworld
Which Area <span class=o>(</span>frontend, adminhtml<span class=o>)</span>? <span class=o>(</span>frontend<span class=o>)]</span> 
Frontname/Route ID? <span class=o>(</span>pulsestorm_helloworld<span class=o>)]</span> rick_helloworld
Controller name? <span class=o>(</span>Index<span class=o>)]</span> 
Action name? <span class=o>(</span>Index<span class=o>)]</span> 
Backing existing file: /var/www/html/app/code/Rick/Helloworld/etc/frontend/routes.xml.5f1db51e071db.bak.php
/var/www/html/app/code/Rick/Helloworld/etc/frontend/routes.xml
/var/www/html/app/code/Rick/Helloworld/Controller/Index/Index.php
</code></pre></div><p>After you will see a routes.xml in <em>app/code/Rick/HelloWorld/etc/routes.xml</em></p><div class=highlight><pre class=chroma><code class=language-xml data-lang=xml><span class=ln>1</span><span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
<span class=ln>2</span><span class=nt>&lt;config</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class=na>xsi:noNamespaceSchemaLocation=</span><span class=s>&#34;urn:magento:framework:App/etc/routes.xsd&#34;</span><span class=nt>&gt;</span>
<span class=ln>3</span>    <span class=nt>&lt;router</span> <span class=na>id=</span><span class=s>&#34;standard&#34;</span><span class=nt>&gt;</span>
<span class=ln>4</span>        <span class=nt>&lt;route</span> <span class=na>id=</span><span class=s>&#34;rick_helloworld&#34;</span> <span class=na>frontName=</span><span class=s>&#34;rick_helloworld&#34;</span><span class=nt>&gt;</span>
<span class=ln>5</span>            <span class=nt>&lt;module</span> <span class=na>name=</span><span class=s>&#34;Rick_Helloworld&#34;</span><span class=nt>/&gt;</span>
<span class=ln>6</span>        <span class=nt>&lt;/route&gt;</span>
<span class=ln>7</span>    <span class=nt>&lt;/router&gt;</span>
<span class=ln>8</span><span class=nt>&lt;/config&gt;</span>
</code></pre></div><p>If a routes.xml already exists, it will add a .bak extension, so that you keep a backup of your existing file. You can choose to remove it, if you no longer need it.</p><p>Finally, we create a front-end view by running:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>php pestle.phar magento2:generate:view
</code></pre></div><p>Choose &ldquo;Rick_Helloworld&rdquo; as the module and accept the default values for Area, Handle, Block Name, Template File and Layout. Eventually you will see that pestle creates the following files.</p><figure><img src=pestle-folder-structure-2.png alt="Pestle folder structure 2"></figure><p>Finally delete your cache with &ldquo;bin/magento c:c&rdquo; and go to https: //app.example.test/Rick_helloworld/index/index</p><figure><img src=pestle-result.png alt="Pestle result"></figure><p>As you can see, within a short time I created, registered & installed a Magento 2 module, built a controller, built a route.xml with a block, layout and template without writing any code. Pestle offers a wide range of options that help you develop Magento 2 modules, so I definitely recommend you to look at the other options that Pestle has to offer.</p><h2 id=useful-commands-in-pestle>Useful commands in Pestle</h2><p>In addition to generating code, it is also possible to perform scans and checks.</p><p>Corrects immediate use of PHP Object Manager</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar magento2:fix-direct-om
</code></pre></div><p>Restores rights</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar magento2:fix-permissions-mod
</code></pre></div><p>Scans modules for ACL rule IDs and ensures that they are all used / defined</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar magento2:scan:acl-used
</code></pre></div><p>Searches for invalid keys in a MySQL database</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar mysql:key-check
</code></pre></div><p>Migrating from Magento 1 code to Magento 2</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>php pestle.phar magento2:convert-class
php pestle.phar magento2:convert-observers-xml
php pestle.phar magento2:convert-system-xml
</code></pre></div></div><div class=footer><div class=footer-social><span class="social-icon social-icon-twitter"><a href=https://twitter.com/zerostaticio title=twitter target=_blank rel=noopener><img src=/images/social/twitter.svg width=24 height=24 alt=twitter></a></span>
<span class="social-icon social-icon-github"><a href=https://github.com/zerostaticthemes title=github target=_blank rel=noopener><img src=/images/social/github.svg width=24 height=24 alt=github></a></span>
<span class="social-icon social-icon-linkedin"><a href=https://www.linkedin.com title=linkedin target=_blank rel=noopener><img src=/images/social/linkedin.svg width=24 height=24 alt=linkedin></a></span></div></div></div><script type=text/javascript src=/js/bundle.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js></script></body></html>